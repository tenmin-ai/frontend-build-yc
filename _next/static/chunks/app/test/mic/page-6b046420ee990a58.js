(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[70],{77912:function(i,e,t){Promise.resolve().then(t.bind(t,62089))},62089:function(i,e,t){"use strict";t.r(e),t.d(e,{default:function(){return o}});var a=t(57437),n=t(49677),s=t(99376),r=t(2265);function l(){let[i,e]=(0,r.useState)(0),t=(0,n.Z)({onAlwaysPCMData:i=>{let t=new DataView(i),a=0;for(let e=0;e<i.byteLength;e+=2)a+=Math.abs(t.getInt16(e,!0));e(20*Math.log10(a/(i.byteLength/2)/32767))},onPCMData:i=>{console.log("PCM data:",i)},onAudioData(i){console.log("Audio data:",i)},recordingChunkSize:100});return(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsx)("h1",{}),(0,a.jsx)("pre",{children:JSON.stringify(t,null,2)}),(0,a.jsxs)("p",{children:["Volume: ",i]}),(0,a.jsx)("div",{className:"relative h-[20px] w-[100px] bg-black",children:(0,a.jsx)("div",{className:"h-full bg-green-500 transition-all duration-0 ease-linear",style:{width:"".concat(Math.max(0,Math.min(100,i+100)),"%")}})}),(0,a.jsxs)("button",{onClick:()=>t.isRecording?t.stopRecording():t.startRecording(),children:["Set recording to ",JSON.stringify(!t.isRecording)]}),(0,a.jsxs)("button",{onClick:()=>t.setMuted(!t.isMuted),children:["Mute: ",JSON.stringify(t.isMuted)]})]})}function o(){let[i,e]=(0,r.useState)(!0),t=(0,s.useRouter)();return(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsx)("h1",{children:"Debug page"}),(0,a.jsx)("a",{onClick:()=>t.push("/"),children:"Back to home"}),(0,a.jsx)("button",{onClick:()=>e(!i),children:"Show/hide mic"}),i&&(0,a.jsx)(l,{})]})}},49677:function(i,e,t){"use strict";t.d(e,{Z:function(){return r}});var a=t(2265),n=t(9800);class s{init(){if(this.isInitialized){console.warn("MicManager: already initialized");return}if(this.initializing){console.warn("MicManager: already initializing");return}this.initializing=this._init()}async _init(){var i;for(let e of(console.log("MicManager init start...",this),this.mediaStream=await navigator.mediaDevices.getUserMedia({audio:{deviceId:null!==(i=this.selectedMicId)&&void 0!==i?i:void 0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}}),this.mediaStream.getAudioTracks()))e.enabled=!this.isMuted;this.mediaRecorder=new MediaRecorder(this.mediaStream),await this.initVad(),this.isInitialized=!0,this.initializing=null,console.log("MicManager init complete.")}async initVad(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.mediaStream){console.warn("MicManager: no mediaStream to initVad");return}if(this.vad&&!i){console.warn("MicManager: vad already initialized");return}this.vad&&(console.warn("MicManager: vad already initialized, but forcing re-init"),this.destroyVad()),this.vad=await n.MicVAD.new({baseAssetPath:"/vad/",onnxWASMBasePath:"/vad/",stream:this.mediaStream,onSpeechStart:()=>{var i;this.isVoiceDetected=!0,null===(i=this.onSpeechStart)||void 0===i||i.call(this)},onVADMisfire:()=>{var i;this.isVoiceDetected=!1,null===(i=this.onSpeechEnd)||void 0===i||i.call(this,!0)},onSpeechEnd:()=>{var i;this.isVoiceDetected=!1,null===(i=this.onSpeechEnd)||void 0===i||i.call(this,!1)},onFrameProcessed:(i,e)=>{var t,a;this.lastPCMTimestamp=Date.now();let n=new ArrayBuffer(2*e.length),s=new DataView(n);for(let i=0;i<e.length;i++)s.setInt16(2*i,32767*e[i],!0);null===(t=this.onAlwaysPCMData)||void 0===t||t.call(this,n),this.capturingPCM&&(null===(a=this.onPCMData)||void 0===a||a.call(this,n))}}),this.vad.start()}destroyVad(){this.vad?(this.vad.destroy(),this.vad=null,this.lastPCMTimestamp=null):console.warn("MicManager: no vad to destroy")}async ensureVad(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.vad&&this.lastPCMTimestamp&&Date.now()-this.lastPCMTimestamp<i||(console.warn("MicManager: vad is broken, re-initializing..."),await this.initVad(!0))}startPCM(){this.capturingPCM=!0}stopPCM(){this.capturingPCM=!1}setMuted(){var i;let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.isMuted!==e&&(this.ensureVad(),this.isMuted=e,null===(i=this.mediaStream)||void 0===i||i.getAudioTracks().forEach(i=>{i.enabled=!e}))}startRecording(){if(this.mediaRecorder||console.warn("MicManager: no mediaRecorder to start"),this.isRecording){console.warn("MicManager: already recording");return}this.ensureVad(),this.isRecording=!0,this.wasCancelled=!1,this.startPCM(),this.mediaRecorder&&(this.mediaRecorder.ondataavailable=i=>{this.lastDataAvailablePromise=(async()=>{var e;let t=await i.data.arrayBuffer();null===(e=this.onAudioData)||void 0===e||e.call(this,t)})()},this.mediaRecorder.onstart=()=>{var i;null===(i=this.onRecordingStart)||void 0===i||i.call(this)},this.mediaRecorder.onstop=async()=>{var i;this.lastDataAvailablePromise&&await this.lastDataAvailablePromise,this.isRecording=!1,null===(i=this.onRecordingStop)||void 0===i||i.call(this,this.wasCancelled)},this.mediaRecorder.start(this.recordingChunkSize))}stopRecording(){var i;this.isRecording&&(this.ensureVad(),this.stopPCM(),null===(i=this.mediaRecorder)||void 0===i||i.stop())}cancelRecording(){this.isRecording&&(this.ensureVad(),this.wasCancelled=!0,this.stopRecording())}async destroy(){if(!this.isInitialized&&!this.initializing){console.warn("MicManager: not initialized nor initializing");return}if(this.initializing&&(console.info("MicManager: still initializing, waiting..."),await this.initializing),console.log("MicManager: destroying..."),this.destroyVad(),this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder.ondataavailable=null,this.mediaRecorder.onstop=null,this.mediaRecorder.onstart=null,this.mediaRecorder=null),this.mediaStream&&(this.mediaStream.getTracks().forEach(i=>i.stop()),this.mediaStream=null),this.isVoiceDetected){var i;this.isVoiceDetected=!1,null===(i=this.onSpeechEnd)||void 0===i||i.call(this,!1)}this.isRecording=!1,this.wasCancelled=!1,this.capturingPCM=!1,this.isInitialized=!1,console.log("MicManager: destroyed")}constructor({recordingChunkSize:i=100,selectedMicId:e=null,onSpeechStart:t,onSpeechEnd:a,onAlwaysPCMData:n,onPCMData:s,onAudioData:r,onRecordingStart:l,onRecordingStop:o}){this.mediaStream=null,this.mediaRecorder=null,this.vad=null,this.isMuted=!1,this.isRecording=!1,this.wasCancelled=!1,this.isVoiceDetected=!1,this.capturingPCM=!1,this.lastPCMTimestamp=null,this.lastDataAvailablePromise=null,this.isInitialized=!1,this.initializing=null,this.recordingChunkSize=i,this.selectedMicId=e,this.onSpeechStart=t,this.onSpeechEnd=a,this.onAlwaysPCMData=n,this.onPCMData=s,this.onAudioData=r,this.onRecordingStart=l,this.onRecordingStop=o}}function r(i){let{startMuted:e=!1,recordingChunkSize:t=100,onSpeechStart:n,onSpeechEnd:r,onAlwaysPCMData:l,onPCMData:o,onAudioData:c,onRecordingStart:d,onRecordingStop:h}=i,[u,g]=(0,a.useState)("AirPods"),[v,M]=(0,a.useState)(!1),[f,m]=(0,a.useState)(!1),[R,p]=(0,a.useState)(e),S=(0,a.useRef)(null),w=(0,a.useRef)(n),C=(0,a.useRef)(r),y=(0,a.useRef)(l),P=(0,a.useRef)(o),D=(0,a.useRef)(c),b=(0,a.useRef)(d),z=(0,a.useRef)(h);return(0,a.useEffect)(()=>{w.current=n},[n]),(0,a.useEffect)(()=>{C.current=r},[r]),(0,a.useEffect)(()=>{y.current=l},[l]),(0,a.useEffect)(()=>{P.current=o},[o]),(0,a.useEffect)(()=>{D.current=c},[c]),(0,a.useEffect)(()=>{b.current=d},[d]),(0,a.useEffect)(()=>{z.current=h},[h]),(0,a.useEffect)(()=>{let i=new s({selectedMicId:u,recordingChunkSize:t,onSpeechStart:()=>{var i;m(!0),null===(i=w.current)||void 0===i||i.call(w)},onSpeechEnd:i=>{var e;m(!1),null===(e=C.current)||void 0===e||e.call(C,i)},onAlwaysPCMData:i=>{var e;null===(e=y.current)||void 0===e||e.call(y,i)},onPCMData:i=>{var e;null===(e=P.current)||void 0===e||e.call(P,i)},onAudioData:i=>{var e;null===(e=D.current)||void 0===e||e.call(D,i)},onRecordingStart:()=>{var i;M(!0),null===(i=b.current)||void 0===i||i.call(b)},onRecordingStop:i=>{var e;M(!1),null===(e=z.current)||void 0===e||e.call(z,i)}});return S.current=i,i.init(),()=>{i.destroy(),S.current=null}},[u]),(0,a.useEffect)(()=>{var i;null===(i=S.current)||void 0===i||i.setMuted(R)},[R]),{isMuted:R,isRecording:v,isVoiceDetected:f,selectedMic:u,acquireMic:function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;g(i)},setMuted:p,startRecording:()=>{var i;null===(i=S.current)||void 0===i||i.startRecording()},stopRecording:()=>{var i;return null===(i=S.current)||void 0===i?void 0:i.stopRecording()},cancelRecording:()=>{var i;return null===(i=S.current)||void 0===i?void 0:i.cancelRecording()}}}}},function(i){i.O(0,[1015,2648,2971,2117,1744],function(){return i(i.s=77912)}),_N_E=i.O()}]);