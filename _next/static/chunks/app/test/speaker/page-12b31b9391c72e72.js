(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1723],{82460:function(e,n,t){Promise.resolve().then(t.bind(t,25094))},25094:function(e,n,t){"use strict";t.r(n);var r=t(57437),u=t(33344),l=t(56870),o=t(89403),i=t(63399),c=t(16593),a=t(53974),s=t(2265),d=t(14438),f=t(74272);let v=()=>{let e=(0,f.MV)("TTS",{volumeMultiplier:1}),[n,t]=(0,s.useState)(1),u=(0,i.Z)({onPlaybackStart:n=>{e.sendAction({type:"PLAYBACK_STARTED",id:n})},onPlaybackFinish:n=>{e.sendAction({type:"PLAYBACK_FINISHED",id:n})},onPlaybackInterrupt:(n,t,r)=>{e.sendAction({type:"PLAYBACK_INTERRUPTED",id:n,played_duration:t,latest_char_index:r})},volume:e.volumeMultiplier,speed:n}),o=(0,l.Y)();return(0,r.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,r.jsx)("h1",{children:"Speaker Debugging!!!!!!"}),(0,r.jsx)("pre",{children:JSON.stringify(u,null,2)}),(0,r.jsx)("pre",{children:JSON.stringify(o.state.toString(),null,2)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{className:"w-40",type:"range",min:"0.5",max:"2",step:"0.1",value:n,onChange:e=>t(parseFloat(e.target.value))}),(0,r.jsxs)("span",{children:["Speed: ",n]})]}),(0,r.jsx)("button",{onClick:()=>{console.log(o.state),u.startSpeaker(),e.sendAction({type:"SAY",text_stream:"아, 그래요? 저희는 아직 그런 프로모션은 없어요. 하지만 다음에 참고하겠습니다. 다른 거 필요한 거 있으세요?",id:"test"})},children:"Speak"})]})};n.default=()=>{var e;let{token:n}=(0,o.f)(),[t,l]=(0,a.useLocalStorage)("language","en"),i=(0,u.rs)({query:{language:t}}),{data:s,isPending:g,isError:h}=(0,c.a)({...i}),p=null===(e=Object.entries(s||{})[0])||void 0===e?void 0:e[0];return g?(0,r.jsx)("div",{children:"Loading..."}):h?(0,r.jsx)("div",{children:"Error loading tutorings"}):(0,r.jsxs)(f.eA,{url:"".concat("wss://backend-us-yc.tenmin.ai","/ws/practice/").concat(p,"?token=").concat(n),toast:d.A,autoconnect:!0,wsAuth:!0,binaryType:"arraybuffer",children:[(0,r.jsx)(v,{}),(0,r.jsx)(d.x,{richColors:!0})]})}},33344:function(e,n,t){"use strict";t.d(n,{GI:function(){return c},PA:function(){return g},ax:function(){return a},bi:function(){return s},iy:function(){return o},rs:function(){return f}});var r=t(52274),u=t(19856);let l=(e,n,t)=>{var r;let l={_id:e,baseUrl:(null!==(r=null==n?void 0:n.client)&&void 0!==r?r:u.Lp).getConfig().baseUrl};return t&&(l._infinite=t),(null==n?void 0:n.body)&&(l.body=n.body),(null==n?void 0:n.headers)&&(l.headers=n.headers),(null==n?void 0:n.path)&&(l.path=n.path),(null==n?void 0:n.query)&&(l.query=n.query),l},o=()=>({mutationFn:async e=>{let{data:n}=await (0,u.H4)({...e,throwOnError:!0});return n}}),i=e=>[l("userMyData",e)],c=e=>(0,r.C)({queryFn:async n=>{let{queryKey:t}=n,{data:r}=await (0,u.It)({...e,...t[0],throwOnError:!0});return r},queryKey:i(e)}),a=()=>({mutationFn:async e=>{let{data:n}=await (0,u._5)({...e,throwOnError:!0});return n}}),s=()=>({mutationFn:async e=>{let{data:n}=await (0,u._G)({...e,throwOnError:!0});return n}}),d=e=>[l("tutoringGetAll",e)],f=e=>(0,r.C)({queryFn:async n=>{let{queryKey:t}=n,{data:r}=await (0,u.zW)({...e,...t[0],throwOnError:!0});return r},queryKey:d(e)}),v=e=>[l("tutoringGetLeaderboard",e)],g=e=>(0,r.C)({queryFn:async n=>{let{queryKey:t}=n,{data:r}=await (0,u.Vz)({...e,...t[0],throwOnError:!0});return r},queryKey:v(e)})},19856:function(e,n,t){"use strict";t.d(n,{H4:function(){return o},Hy:function(){return s},I:function(){return y},It:function(){return d},Lp:function(){return u},Vz:function(){return h},_5:function(){return f},_G:function(){return v},c_:function(){return a},eU:function(){return l},kc:function(){return i},oY:function(){return p},pR:function(){return c},zW:function(){return g}});var r=t(75478);let u=(0,r.eI)((0,r._g)()),l=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,...r.RL,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/login"})},o=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).patch({...e,url:"/change_login"})},i=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/oauth/google/login"})},c=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/oauth/google/callback"})},a=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/user/create_account_and_profile"})},s=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/user/add_new_profile"})},d=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/user/my_data"})},f=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).patch({...e,url:"/user/change_profile"})},v=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/lesson/generate_user_roleplay"})},g=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/tutoring/all"})},h=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).get({...e,url:"/tutoring/leaderboard"})},p=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/call/start/{service}"})},y=e=>{var n;return(null!==(n=null==e?void 0:e.client)&&void 0!==n?n:u).post({...e,url:"/stats/premium"})}},56870:function(e,n,t){"use strict";t.d(n,{GlobalAudioContextProvider:function(){return o},Y:function(){return i}});var r=t(57437),u=t(2265);let l=(0,u.createContext)(null),o=e=>{let{children:n}=e,t=(0,u.useRef)(null);return t.current||(console.log("creating audio context"),t.current=new AudioContext,t.current.onstatechange=()=>{var e,n,r,u,l,o;if(console.log("onstagechange - AudioContext state changed: ",null===(e=t.current)||void 0===e?void 0:e.state),(null===(n=t.current)||void 0===n?void 0:n.state)==="suspended"&&(console.log("Attempting to resume AudioContext..."),null===(l=t.current)||void 0===l||l.resume().then(()=>{var e;console.log("AudioContext state: ",null===(e=t.current)||void 0===e?void 0:e.state)}).catch(e=>{console.error("Failed to resume AudioContext:",e)})),(null===(r=t.current)||void 0===r?void 0:r.state.toString())==="interrupted"&&console.log("Safari interrupted audiocontext, but won't resume for now..."),(null===(u=t.current)||void 0===u?void 0:u.state)==="running"){let e=null===(o=t.current)||void 0===o?void 0:o.currentTime;setTimeout(()=>{var n;(null===(n=t.current)||void 0===n?void 0:n.currentTime)===e&&console.warn("AudioContext currentTime is stuck, attempting to fix...")},100)}}),(0,r.jsx)(l.Provider,{value:t.current,children:n})},i=()=>{let e=(0,u.useContext)(l);if(!e)throw Error("useAudioContext must be used within a GlobalAudioContextProvider");return e}},89403:function(e,n,t){"use strict";t.d(n,{f:function(){return u}});var r=t(53974);let u=()=>{let[e,n]=(0,r.useLocalStorage)("token");return{token:e,saveToken:n}}},63399:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(2265),u=t(74272),l=t(56870);function o(e){let{onPlaybackStart:n,onPlaybackFinish:t,onPlaybackInterrupt:o,volume:i=1,speed:c=1}=e,a=(0,r.useContext)(u.Dm),s=(0,l.Y)(),d=(0,r.useRef)([]),f=(0,r.useRef)(0),v=(0,r.useRef)(null),g=(0,r.useRef)([]),h=(0,r.useRef)(null),p=(0,r.useRef)(null),y=(0,r.useRef)(!1),[m,x]=(0,r.useState)(!1),_=(0,r.useRef)(m),[T,b]=(0,r.useState)(!1),[E,S]=(0,r.useState)(null),A=(0,r.useRef)(null),[w,C]=(0,r.useState)(null),k=(0,r.useRef)(null),R=()=>{N(),null!==p.current&&(p.current.disconnect(),p.current=null,console.log("Phase vocoder node disconnected and released")),null!==h.current&&(h.current.disconnect(),h.current=null,console.log("Gain node disconnected and released"))},N=()=>{if(g.current.forEach(e=>{clearTimeout(e)}),g.current=[],v.current&&(clearTimeout(v.current),v.current=null),0===d.current.length)return;let e=1,n=d.current.slice(0,5);for(let t of n)if(t&&t.buffer){let n=t.buffer.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=n[t]*e,e-=1/(5*n.length)}d.current.slice(5).forEach(e=>{e.onended=null,e.stop()}),x(!1),_.current=!1;let t=s.currentTime-f.current;null==o||o(A.current,t,w),d.current=n},j=()=>{x(!1),_.current=!1,b(!1),g.current=[],k.current=null,null==t||t(A.current)},P=async e=>{let{i:t,data:r,id:u,t:l}=e,o=new Int16Array(r),i=s.createBuffer(1,o.length,24e3),a=i.getChannelData(0);for(let e=0;e<o.length;e++)a[e]=o[e]/32768;if(null===h.current){console.error("Gain node not created yet"),alert("Speaker not ready yet, this should not happen");return}let p=s.createBufferSource();p.connect(h.current),p.playbackRate.value=c,p.buffer=i;let y=0==t;y&&(d.current.length>0&&N(),f.current=s.currentTime,console.log("Audio start time reset to",f.current));let m=f.current+.1*t/c+.1,T=s.currentTime-m;if(T>0&&(console.log("Audio chunk is late, delaying playback by ".concat(T," seconds.")),m+=T,f.current+=T),p.start(m),d.current.push(p),y&&(v.current=setTimeout(()=>{x(!0),_.current=!0,null==n||n(u),C(0),void 0==u&&console.error("First chunk must have an id"),S(u),A.current=u,v.current=null},-(1e3*T))),p.onended=()=>{d.current.length>0&&(d.current.shift(),b(!1)),k.current&&t==k.current-1?(console.log("Natural end of audio"),j()):0===d.current.length&&(console.log("Lagging, no more audio to play"),b(!0))},void 0!=l){let e=g.current.length,n=s.currentTime,t=l.map((t,r)=>setTimeout(()=>C(e+r),1e3*(f.current+t-n)/c));g.current.push(...t)}};return(0,r.useEffect)(()=>{if(!a){console.log("No session found!");return}return a.registerEvent("TTS_CHUNK",P),a.registerEvent("TTS_INTERRUPT",()=>{N()}),a.registerEvent("TTS_END",e=>{let{id:n,len:t}=e;k.current=t}),()=>{null==a||a.deregisterEvent("TTS_CHUNK"),null==a||a.deregisterEvent("TTS_INTERRUPT"),null==a||a.deregisterEvent("TTS_END")}},[a,c]),(0,r.useEffect)(()=>{h.current&&(h.current.gain.value=i)},[i]),(0,r.useEffect)(()=>{p.current&&(p.current.parameters.get("pitchFactor").value=1/c)},[c]),(0,r.useEffect)(()=>()=>{R()},[]),{isPlaying:m,isLagging:T,latestAudioId:E,setLatestAudioId:S,latestCharIndex:w,startSpeaker:(e,n)=>{if(s.resume(),null===h.current){if(y.current){console.log("Speaker is already initializing");return}y.current=!0;try{h.current=s.createGain(),console.log("Gain node created"),h.current.connect(s.destination),h.current.gain.value=i,console.log("Gain node connected to destination"),null==e||e()}catch(e){console.error("Failed to create speaker",e)}finally{y.current=!1}null===h.current&&(null==n||n())}},stopSpeaker:R}}}},function(e){e.O(0,[4060,9763,8802,8351,2971,2117,1744],function(){return e(e.s=82460)}),_N_E=e.O()}]);